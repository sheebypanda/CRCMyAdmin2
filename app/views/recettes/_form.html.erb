<%= simple_form_for(@recette) do |f| %>
  <%= f.error_notification %>

  <div class="card text-danger border-danger mb-3">
    <div class="card-body">
      <h4 class="card-title"><%= fa_icon("server") %> Équipements</h4>
      <div class="form-row">
        <div class='col-lg-12 col-sm-12'>
          <% if params[:action] == 'edit' %>
            <%= f.association :equipement, label: "Sélectionner un équipement", label_method: lambda {|e| "#{e.marque} #{e.modele} - #{e.nom} - #{e.ip}"}, value_method: :id, include_blank: false %>
          <% else %>
            <label for="recette_equipement_id">Sélectionner un équipement existant et non-recetté</label>
            <select class="form-control" name="recette[equipement_id]" id="recette_equipement_id">
              <%  @equipements.each do |e|  %>
              <option value="<%= e.id %>"><%= e.nom %></option>
              <% end %>
            </select>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="card text-info border-info mb-3">
    <div class="card-body">
      <h4 class="card-title"><%= fa_icon("map-marker") %> Localisation</h4>
      <div class="form-row">
        <% if params[:action] == 'edit' %>
          <div class='col-lg-12 col-sm-12' id="filtre-select-loc">
            <%= f.association :localisation, label: "Sélectionner une localisation existante", label_method: lambda { |l| "#{l.ville} #{l.nom}, #{l.adresse}" }, value_method: :id, include_blank: false %>
            <input class="form-control text-filtre" type="text" placeholder="Filtre">
          </div>
        <% else %>
        <div class='col-lg-6 col-sm-12'>
          <label for="recette_equipement_id"><%= fa_icon("university") %>Sélectionner d'abord une ville</label>
          <select class="form-control" name="recette[localisation_ville]" id="recette_localisation_ville">
            <% @villes.each do |ville| %>
              <option value="<%= ville %>"><%= ville %></option>
            <% end %>
          </select>
        </div>
        <div class='col-lg-6 col-sm-12'>
          <label for="recette_equipement_id"><%= fa_icon("map-marker") %>... puis un lieu</label><br/>
          <select class="form-control recette_localisation_id" name="recette[localisation_id]" id="recette_localisation_id">
            <% @localisations.each do |loc| %>
              <option class="loc <%= loc.ville.delete(' ') if loc.ville %>" value="<%= loc.id %>"><%= loc.nom %></option>
            <% end %>
          </select>
        </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="card text-warning border-warning mb-3 internet">
    <div class="card-body">
      <h4 class="card-title"><%= fa_icon("globe") %> Sortie internet</h4>
      <div class="form-row">
        <div class='col-lg-12 col-sm-12'>
          <% if params[:action] == 'edit' %>
            <%= f.association :ligne, label: "Sélectionner une ligne existante", label_method: lambda { |l| "#{l.techno} #{l.numerocompte} - #{l.ndi}" }, value_method: :id, include_blank: false %>
          <% else %>
          <label for="recette_equipement_id">Sélectionner une sortie internet</label>
          <select class="form-control" name="recette[ligne_id]" id="recette_ligne_id">
            <% fpbm = Ligne.where(numerocompte: "Fibre privée BM") %>
            <option value="<%=fpbm.first.id %>"><%=fpbm.first.numerocompte %></option>
            <% @lignes.each do |lig| %>
              <%  recettes =  Recette.where(ligne_id: lig.id) %>
              <% if recettes.count > 0 %>
                <% recettes.each do |r| %>
                  <% l = Localisation.find(r.localisation_id) %>
                  <option class="<%= l.id %> ligne" value="<%= lig.id %>"><%= lig.numerocompte %> - <%= lig.ndi %></option>
                <% end %>
              <% end %>
            <% end %>
          </select>
          <% end %>
        </div>
      </div>
    </div>
  </div>


  <div class="card text-success border-success mb-3">
    <div class="card-body">
      <h4 class="card-title"><%= fa_icon("check") %> Test de conformité</h4>

      <div class="form-row">
        <div class='col-lg-6 col-sm-12'>
          <%= f.input :snmp, label: "Communauté SNMP ajoutée"%>
        </div>
        <div class='col-lg-6 col-sm-12'>
          <%= f.input :tacacs, label: "Authentification TACACS effectué"%>
        </div>
      </div>
      <div class="form-row">
        <div class='col-lg-6 col-sm-12'>
          <%= f.input :testdebit, label: "Test de débit effectués"%>
        </div>
        <div class='col-lg-6 col-sm-12'>
          <%= f.input :supervision, label: "Équipement supervisé"%>
        </div>
      </div>
      <%= f.input :etiquette, label: "Étiquette collée sur l'équipement"%>

    </div>
  </div>

  <%= f.button :submit, "Valider et ajouter la fiche recette", class: "btn btn-block btn-outline-primary mb-3" %>

<% end %>
